<!doctype html>
<html lang="es">

<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<title>Nuestra Boda ‚Äî C√°mara</title>

<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@600&family=Montserrat:wght@500;700&display=swap" rel="stylesheet">

<style>
:root{--bg1:#0e0e10;--bg2:#1b1b1f;--gold:#d4af37;--gold2:#f6e27a;}
html,body{margin:0;height:100%;background:linear-gradient(160deg,var(--bg1),var(--bg2));color:#fff;font-family:Montserrat}
.wrap{position:fixed;inset:0;display:flex;flex-direction:column}

header{text-align:center;padding:12px 0;font-family:Cinzel;font-size:22px}
header span{background:linear-gradient(45deg,var(--gold),var(--gold2));-webkit-background-clip:text;color:transparent}

.videoBox{flex:1;position:relative;overflow:hidden;display:flex;align-items:center;justify-content:center}
video{position:absolute;inset:0;width:100%;height:100%;object-fit:cover}

.frame{position:absolute;inset:0;margin:auto;aspect-ratio:9/16;width:min(100vw,56vh);
border:2px solid rgba(255,255,255,.18);border-radius:22px;box-shadow:0 0 0 999vmax rgba(0,0,0,.25) inset}

.controls{position:absolute;bottom:22px;left:0;right:0;display:flex;flex-direction:column;gap:14px;align-items:center}
.row{display:flex;gap:16px}

.btn{border:none;border-radius:999px;padding:16px;background:rgba(0,0,0,.55);color:#fff;backdrop-filter:blur(6px);display:flex;align-items:center;justify-content:center}
.btn-round{width:78px;height:78px}
.btn-warn{background:rgba(255,184,77,.28)}
.btn-gold{background:rgba(212,175,55,.28)}
.btn-green{background:rgba(70,212,107,.28)}

.toast{position:absolute;top:70px;left:50%;transform:translateX(-50%);background:rgba(0,0,0,.6);padding:10px 14px;border-radius:12px;opacity:0;transition:.3s}
.toast.show{opacity:1}

.loader{position:absolute;inset:0;background:rgba(0,0,0,.35);display:none;align-items:center;justify-content:center}
.loader.show{display:flex}
</style>
</head>

<body>
<div class="wrap">

<header><span>Andrey üíñ Yazmin ‚Äî 22 Nov</span></header>

<div class="videoBox">
  <video id="preview" autoplay playsinline muted></video>
  <div class="frame"></div>

  <div class="loader" id="loader"><div style="font-size:20px">‚è≥</div></div>
  <div class="toast" id="toast">Listo</div>

  <div class="controls">

    <div class="row">
      <button class="btn btn-warn" id="flashBtn">‚ö°</button>
      <button class="btn btn-warn" id="galleryBtn">üìÅ</button>
      <button class="btn btn-warn" id="fsBtn">‚õ∂</button>
    </div>

    <div class="row">
      <button class="btn btn-gold btn-round" id="photoBtn">üì∏</button>
      <button class="btn btn-green btn-round" id="recBtn">üé•</button>
      <button class="btn btn-warn btn-round" id="stopBtn" style="display:none">‚èπ</button>
    </div>

  </div>
</div>

<!-- FORMULARIO OCULTO PARA EVITAR CORS -->
<iframe name="uploadFrame" style="display:none;"></iframe>
<form id="uploadForm" action="https://script.google.com/macros/s/AKfycbx00pCRx5FQ-rgQ5VklDxeh4Hy9bs7QgU7ZplPfq7qXHiRbvwHuDzgy2VUzugJat6Iq/exec"
      method="post" enctype="multipart/form-data" target="uploadFrame" style="display:none">
   <input type="file" id="realFile" name="file">
   <input type="text" id="realName" name="filename">
</form>

<script>
/* ============================= */
const UPLOAD_FORM = document.getElementById("uploadForm");
const REAL_FILE  = document.getElementById("realFile");
const REAL_NAME  = document.getElementById("realName");
/* ============================= */

function showToast(t){const x=document.getElementById("toast");x.textContent=t;x.classList.add("show");setTimeout(()=>x.classList.remove("show"),1500)}
function setLoading(b){document.getElementById("loader").classList.toggle("show",b)}

let stream,rec,chunks=[];

/* INICIAR C√ÅMARA */
(async()=>{
  stream=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"},audio:false});
  document.getElementById("preview").srcObject=stream;

  const caps=stream.getVideoTracks()[0].getCapabilities();
  window.torchOK=!!caps.torch;
})();

/* FLASH */
flashBtn.onclick=async()=>{
  if(!window.torchOK){showToast("No soporta flash");return}
  const track=stream.getVideoTracks()[0];
  window.torch=!window.torch;
  await track.applyConstraints({advanced:[{torch:window.torch}]});
};

/* FULLSCREEN */
fsBtn.onclick=()=>!document.fullscreenElement?document.documentElement.requestFullscreen():document.exitFullscreen();

/* GALER√çA INPUT */
const galleryInput=document.createElement("input");
galleryInput.type="file";galleryInput.accept="image/*";galleryInput.style.display="none";
document.body.appendChild(galleryInput);
galleryBtn.onclick=()=>galleryInput.click();
galleryInput.onchange=e=>{if(e.target.files[0]) uploadFile(e.target.files[0],e.target.files[0].name)};

/* FOTO */
photoBtn.onclick=()=>{
  const v=document.getElementById("preview");
  const c=document.createElement("canvas");
  c.width=1080;c.height=1920;
  c.getContext("2d").drawImage(v,0,0,1080,1920);
  c.toBlob(b=>uploadFile(b,"foto_"+Date.now()+".png"),"image/png");
};

/* VIDEO */
recBtn.onclick=()=>{
  chunks=[];rec=new MediaRecorder(stream,{mimeType:"video/webm"});
  rec.ondataavailable=e=>chunks.push(e.data);
  rec.onstop=()=>{
    const blob=new Blob(chunks,{type:"video/webm"});
    uploadFile(blob,"video_"+Date.now()+".webm");
  };
  rec.start();
  recBtn.style.display="none";stopBtn.style.display="inline-flex";
};
stopBtn.onclick=()=>{rec.stop();recBtn.style.display="inline-flex";stopBtn.style.display="none"};

/* SUBIR ARCHIVO SIN CORS */
function uploadFile(blob,name){
  setLoading(true);

  const file=new File([blob],name,{type:blob.type});
  REAL_FILE.files = createFileList(file);
  REAL_NAME.value = name;

  UPLOAD_FORM.submit();

  setTimeout(()=>{setLoading(false);showToast("Guardado en Drive")},1200);
}

function createFileList(file){
  const dt=new DataTransfer();
  dt.items.add(file);
  return dt.files;
}
</script>

</body>
</html>
