<!doctype html>
<html lang="es">

<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<title>Nuestra Boda ‚Äî C√°mara</title>

<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@600&family=Montserrat:wght@500;700&display=swap" rel="stylesheet">

<style>
/* --- ESTILOS DE BODA --- */
:root{
  --bg1:#0e0e10; --bg2:#1b1b1f;
  --gold:#d4af37; --gold2:#f6e27a;
}
html,body{
  margin:0;height:100%;
  background:linear-gradient(160deg,var(--bg1),var(--bg2));
  color:#fff;font-family:Montserrat;
}
.wrap{position:fixed;inset:0;display:flex;flex-direction:column}
header{text-align:center;padding:12px 0;font-family:Cinzel;font-size:22px}
header span{
  background:linear-gradient(45deg,var(--gold),var(--gold2));
  -webkit-background-clip:text;color:transparent;
}

.videoBox{
  flex:1;position:relative;overflow:hidden;
  display:flex;align-items:center;justify-content:center;
}

video{
  position:absolute;inset:0;
  width:100%;height:100%;object-fit:cover;
}

/* Marco tipo Instagram */
.frame{
  position:absolute;inset:0;margin:auto;
  aspect-ratio:9/16;width:min(100vw,56vh);
  border:2px solid rgba(255,255,255,0.18);
  border-radius:22px;
  box-shadow:0 0 0 999vmax rgba(0,0,0,0.25) inset;
}

/* Controles */
.controls{
  position:absolute;bottom:22px;left:0;right:0;
  display:flex;flex-direction:column;gap:14px;
  justify-content:center;align-items:center;
}
.row{display:flex;gap:16px}

.btn{
  border:none;border-radius:999px;
  padding:16px;background:rgba(0,0,0,0.55);
  color:#fff;backdrop-filter:blur(6px);
  display:flex;align-items:center;justify-content:center;
}
.btn-round{width:78px;height:78px}
.btn-gold{background:rgba(212,175,55,0.25)}
.btn-green{background:rgba(70,212,107,0.28)}
.btn-warn{background:rgba(255,184,77,0.28)}

.toast{
  position:absolute;top:70px;left:50%;transform:translateX(-50%);
  background:rgba(0,0,0,0.6);padding:10px 14px;border-radius:12px;
  opacity:0;transition:0.3s;
}
.toast.show{opacity:1}

.loader{
  position:absolute;inset:0;background:rgba(0,0,0,0.35);
  display:none;align-items:center;justify-content:center;
}
.loader.show{display:flex}
</style>
</head>

<body>
<div class="wrap">

<header>
  <span>Andrey üíñ Yazmin ‚Äî 22 Nov</span>
</header>

<div class="videoBox">
  <video id="preview" autoplay playsinline muted></video>
  <div class="frame"></div>

  <div class="loader" id="loader"><div style="font-size:20px">‚è≥</div></div>
  <div class="toast" id="toast">Listo</div>

  <div class="controls">
    <div class="row">
      <button class="btn btn-warn" id="flashBtn">‚ö°</button>
      <button class="btn btn-warn" id="galleryBtn">üìÅ</button>
      <button class="btn btn-warn" id="fsBtn">‚õ∂</button>
    </div>

    <div class="row">
      <button class="btn btn-gold btn-round" id="photoBtn">üì∏</button>
      <button class="btn btn-green btn-round" id="recBtn">üé•</button>
      <button class="btn btn-warn btn-round" id="stopBtn" style="display:none">‚èπ</button>
    </div>
  </div>
</div>

<script>
/* ============================ */
/*   CONFIGURA TU SCRIPT AQU√ç   */
/* ============================ */
const UPLOAD_URL = "https://script.google.com/macros/s/AKfycbwq1J0Yw2ODrh3LGX0HOZyUWv2Ue-3yPEJx1CNm9UcMTTr2ROMtRvX5FOanc74zgEz0/exec";

/* ============================ */
/*  VARIABLES GLOBALES         */
/* ============================ */
let stream, mediaRecorder, chunks=[];
let torch=false, torchOK=false;

/* ============================ */
/*      UTILIDADES UI          */
/* ============================ */
const toast=document.getElementById("toast");
const loader=document.getElementById("loader");

function showToast(msg){
  toast.textContent=msg;
  toast.classList.add("show");
  setTimeout(()=>toast.classList.remove("show"),1600);
}
function setLoading(b){ loader.classList.toggle("show",b); }

/* ============================ */
/*      INICIAR C√ÅMARA         */
/* ============================ */
(async function initCamera(){
  try{
    stream = await navigator.mediaDevices.getUserMedia({
      video:{facingMode:"environment",width:{ideal:1080},height:{ideal:1920}},
      audio:false
    });

    const track = stream.getVideoTracks()[0];
    const caps = track.getCapabilities();
    torchOK = !!caps.torch;

    document.getElementById("preview").srcObject = stream;

  }catch(err){
    showToast("No se pudo abrir la c√°mara");
  }
})();

/* ============================ */
/*       FLASH / TORCH          */
/* ============================ */
document.getElementById("flashBtn").onclick=async()=>{
  if(!torchOK) return showToast("Flash no soportado");
  const track=stream.getVideoTracks()[0];
  torch = !torch;
  await track.applyConstraints({advanced:[{torch}]});
};

/* ============================ */
/*       FULLSCREEN             */
/* ============================ */
document.getElementById("fsBtn").onclick=()=>{
  if(!document.fullscreenElement) document.documentElement.requestFullscreen();
  else document.exitFullscreen();
};

/* ============================ */
/*       GALER√çA INPUT          */
/* ============================ */
const galleryInput=document.createElement("input");
galleryInput.type="file";
galleryInput.accept="image/*";
galleryInput.style.display="none";
document.body.appendChild(galleryInput);

document.getElementById("galleryBtn").onclick=()=> galleryInput.click();

galleryInput.onchange=async(e)=>{
  if(!e.target.files.length) return;
  const file=e.target.files[0];
  uploadBlob(file,file.name);
};

/* ============================ */
/*       TOMAR FOTO             */
/* ============================ */
document.getElementById("photoBtn").onclick=async()=>{

  const video=document.getElementById("preview");
  const canvas=document.createElement("canvas");
  canvas.width=1080; canvas.height=1920;
  const ctx=canvas.getContext("2d");
  ctx.drawImage(video,0,0,1080,1920);

  canvas.toBlob(blob=>{
    uploadBlob(blob,`foto_${Date.now()}.png`);
  },"image/png");
};

/* ============================ */
/*       GRABAR VIDEO           */
/* ============================ */
document.getElementById("recBtn").onclick=()=>{

  chunks=[];
  mediaRecorder=new MediaRecorder(stream,{mimeType:"video/webm"});
  mediaRecorder.ondataavailable=e=>chunks.push(e.data);

  mediaRecorder.onstop=()=>{
    const blob=new Blob(chunks,{type:"video/webm"});
    uploadBlob(blob,`video_${Date.now()}.webm`);
  };

  mediaRecorder.start();
  document.getElementById("recBtn").style.display="none";
  document.getElementById("stopBtn").style.display="inline-flex";
};

document.getElementById("stopBtn").onclick=()=>{
  mediaRecorder.stop();
  document.getElementById("recBtn").style.display="inline-flex";
  document.getElementById("stopBtn").style.display="none";
};

/* ============================ */
/*         SUBIR ARCHIVO        */
/* ============================ */
async function uploadBlob(blob,filename){
  setLoading(true);

  const base64 = await blobToBase64(blob);
  const body={
    filename,
    mimeType:blob.type,
    base64
  };

  try{
    const res=await fetch(UPLOAD_URL,{
      method:"POST",
      headers:{ "Content-Type":"application/json" },
      body:JSON.stringify(body)
    });

    const json=await res.json();
    setLoading(false);

    if(json.ok) showToast("Guardado en Drive");
    else showToast("Error al subir");
    
  }catch(err){
    setLoading(false);
    showToast("Fallo conexi√≥n");
  }
}

function blobToBase64(blob){
  return new Promise(res=>{
    const r=new FileReader();
    r.onload=()=>res(r.result.split(",")[1]);
    r.readAsDataURL(blob);
  });
}
</script>

</body>
</html>
